<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="css/lib/public.css">
		<link rel="stylesheet" type="text/css" href="css/custom/webStyle.css"/>
		<link rel="stylesheet" type="text/css" href="css/custom/play.css">
		<link rel="stylesheet" type="text/css" href="css/lib/animate.min.css">
		<script type="text/javascript" src="libs/jquery/jquery.js"></script>
		<script type="text/javascript" src="libs/vuejs/vue.js"></script>
		
		<script type="text/javascript" src="libs/layer/layer-v3.1.1/layer/layer.js"></script>
		<script src="js/gobang/common.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/lib/config.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="js/lib/rem.js"></script>
		<script type="text/javascript" src="libs/echarts/echarts.min.js"></script>
		<!-- 棋盘 -->
		<link rel="stylesheet" type="text/css" href="chess/css/chess.css"/>
		<link rel="stylesheet" type="text/css" href="chess/skin/skin1/skin1.css"/>
		<script src="chess/js/eve.js" type="text/javascript" charset="utf-8"></script>
		<script src="chess/js/XSGO.js" type="text/javascript" charset="utf-8"></script>
		<script src="chess/js/bundle.js" type="text/javascript" charset="utf-8"></script>
		<script src="chess/js/GSocket.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/gobang/play.js" type="text/javascript" charset="utf-8"></script>
		<title></title>
	</head>
	<body>
		<div id="matchPlay" class="wa100 ha100">
			<div data-name = "加5分" class="getJf wa100 abs tp140 animated zoomInDown dn" style="z-index:9999999999999;">
				<img src="img/play/jf_5.png" class="w140 h56 db m0a">
			</div> 
			<div class="wa100 h100 mt20 mb15 df ai-c jc-c rel ">
				<img src="img/play/vs.png" class="w67 h48">
				<div class="abs wa100 h100 tp0 lt0 df ai-c jc-sb pl30 pr30">
					<!-- 白 -->
					<div class="w305 df">
						<div :class="['w100 h100 mr15 bra100 b1becff rel',activeUser==1?'b4ff0000':'b4f']">
							<img class="wa100 ha100 bra100" src="img/headImg/1.png" >
							<div class="py_white w30 h30 abs bt0 rt0"></div>
						</div>
						<div class="lh35 ">
							<p class="c3 fs24">{{gameInfo.whiteUserNm}}【{{gameInfo.whiteLevel||'25k'}}】</p>
							<p class="fs22 c6">
								<span class="pr10">{{whiteSeconds}}s</span>
								<span class="pr10">{{vsInfo.whiteCounts?3-vsInfo.whiteCounts:3}}次</span>
								<span>提{{vsInfo.resultList?vsInfo.resultList[1]:0}}子</span>
							</p>
							<p :class="['fs22 c1b1b46 w164 h30  br30 df ai-c',activeUser==1?'bgfde128':'bgf']">
								<img class="w20 h20 mr10 ml10" src="img/play/naozhong.png" ><span style="line-height: 0px;" v-text="(parseInt(whiteTime/60)<10?'0'+parseInt(whiteTime/60):parseInt(whiteTime/60)) +':'+ (whiteTime%60<10?'0'+whiteTime%60:whiteTime%60)"></span>  
							</p>
						</div>
					</div>
					<!-- 黑 -->
					<div class="w305 df jc-fe">
						<div class="lh35 tr">
							<p class="c3 fs24">【{{gameInfo.blackLevel ||'25k'}}】 {{gameInfo.blackUserNm}}</p>
							
							<p class="fs22 c6">
								<span class="pr10">{{blackSeconds}}s</span>
								<span class="pr10">{{vsInfo.blackCounts?3-vsInfo.blackCounts:3}}次</span>
								<span>提{{vsInfo.resultList?vsInfo.resultList[0]:0}}子</span>
							</p>
							<p :class="['fs22 c1b1b46 w164 h30 br30 df ai-c',activeUser==0?'bgfde128':'bgf']">
								<img class="w20 h20 mr10 ml10" src="img/play/naozhong.png" ><span style="line-height: 0px;" v-text="(parseInt(blackTime/60)<10?'0'+parseInt(blackTime/60):parseInt(blackTime/60)) +':'+ (blackTime%60<10?'0'+blackTime%60:blackTime%60)"></span>  
							</p>
						</div>
						<div :class="['w100 h100 ml15 mt10 bra100 b1becff rel',activeUser==0?'b4ff0000':'b4f']">
							<img class="wa100 ha100 bra100" src="img/headImg/1.png" >
							<div class="py_black w30 h30 abs bt0 lt0 cf"></div>
						</div>
					</div>
					
				</div>
			</div>
			<div class="">
				<div class="chessBox wa100 h750 oh">
					<div id="gameChess" class="wa100 h750"></div>
				</div>
				
				<div v-if="qrlzState" class="df ai-c jc-sa pt30 pl20 pr20">
					<button type="button" class="w72 h72 btn-n btn_w" @click="game.steering('w')"></button>
					<button type="button" class="w72 h72 btn-n btn_s" @click="game.steering('s')"></button>
					<button type="button" class="h72 w150 btn-n bt_btn ccf5003 fs30" @click="game.steering('e')">确认落子</button>
					<button type="button" class="w72 h72 btn-n btn_a" @click="game.steering('a')"></button>
					<button type="button" class="w72 h72 btn-n btn_d" @click="game.steering('d')"></button>
				</div>
				<!-- 对弈中功能 -->
				<div v-else-if="!qrlzState && !isReplay "  v-else class="w660  m0a pt30">
					<div class="w680 df fw-w">
						<div class="mb15">
							<button type="button" class="btn-n bt_btn w150 h72 ccf5003 fs30 mr20" @click="inform(4)" v-if="game && game.config.first==game.config.userFirst">停一手</button>
							<button type="button" class="btn_hui btn-n w150 h72 c6 fs30 mr20" v-else>停一手</button>
						</div>
						<div v-if="gameInfo.RuleType2==1" class="mb15">
							<button type="button" class="btn-n w150 h72 fs30 bt_btn ccf5003 mr20"  @click="inform(1)" v-if="game && game.config.first==game.config.userFirst">数棋</button>
							<button type="button" class="btn-n w150 h72 fs30 btn_hui c6 mr20" v-else>数棋</button>
						</div>
						<div class="mb15">
							<button type="button" class="btn-n w150 h72 fs30 bt_btn ccf5003 mr20" @click="inform(3)" v-if="game && game.config.first==game.config.userFirst">悔棋</button>
							<button type="button" class="btn-n w150 h72 fs30 btn_hui c6 mr20" v-else>悔棋</button>
						</div>
						<div class="mb15">
							<button type="button" class="btn-n w150 h72 fs30 bt_btn ccf5003 mr20" @click="inform(2)" v-if="game && game.config.first==game.config.userFirst">和棋</button>
							<button type="button" class="btn-n w150 h72 fs30 btn_hui c6 mr20" v-else>和棋</button>
						</div>
						<button type="button" class="btn-n bt_btn w150 h72 ccf5003 fs30 mr20 fl mb15" @click="giveUp()">认输</button>
						<div v-if="gameInfo.RuleType2==1" class="mb15">
							<button type="button" class="btn-n w150 h72 fs30 bt_btn ccf5003 mr20" @click="statisticalForcereq()" v-if="game && game.config.first==game.config.userFirst">强制数棋</button>
							<button type="button" class="btn-n w150 h72 fs30 btn_hui c6 mr20" v-else>强制数棋</button>
						</div>
						
						<!-- <button type="button" class="btn-n w150 h72 fs30 bt_btn ccf5003 mr20" @click="createAIChess()">创建AI棋局</button>
						
						<button type="button" class="btn-n w150 h72 fs30 bt_btn ccf5003 mr20" @click="randomBattle()">匹配</button> -->
						
					</div>
					
				</div>
				<!-- 复盘中功能 -->
				<div v-else class="wa100">
					<div class="df ai-c jc-sa pt30 pl20 pr20">
						<button type="button" class="w72 h72 btn-n btn_kj1" @click="game.last()"></button>
						<button type="button" class="w72 h72 btn-n btn_kj2" @click="game.nexts()"></button>
						<button type="button" class="w72 h72 btn-n btn_kj3" @click="game.next()"></button>
						<button type="button" class="w72 h72 btn-n btn_kj4" @click="game.prev()"></button>
						<button type="button" class="w72 h72 btn-n btn_kj5" @click="game.prevs()"></button>
						<button type="button" class="w72 h72 btn-n btn_kj6" @click="game.first()"></button>
					</div>
					<div class="df ai-c jc-c pt40">
						<button type="button" class="btn-n bt_btn w150 h72 ccf5003 fs30 mr30" @click="showLot()">显示手数</button>
						<button type="button" class="btn-n bt_btn w150 h72 ccf5003 fs30 mr30" @click="AIhelperreq()" v-if="gameInfo.RuleType2==1">AI支招</button>
						<button type="button" class="btn-n bt_btn w150 h72 ccf5003 fs30 mr30" v-if="!isTry" @click="startTry()" >开始试下</button>
						<button type="button" class="btn-n bt_btn w150 h72 ccf5003 fs30 mr30" v-else @click="endTry()">结束试下</button>
						<button type="button" class="btn-n bt_btn w150 h72 ccf5003 fs30 mr30" @click="jugement()" v-if="gameInfo.RuleType2==1" >{{game.config.isJugement?'关闭形式':'形式判断'}}</button>
					</div>
				</div>
				
				<!-- 形式判断弹框 -->
				<div id="jugementLayer" v-if="game" class="wa100 ha100 layer_bg1 dn">
					<div class="wa100 ha100 df ac-c fw-w">
						<p class="wa100 pb10 tc caa4800 fs36 fwb">形式结果</p>
						<div class="w520 h240 m0a bgf br32 fs30 caa4800 oay tc pt10 lineh50">
							<p class="cff3000 fs36 pb25 pt20">{{getInfo(sqResult.blackNum,sqResult.whiteNum).title}}</p>
							<div class="df jc-sa ">
								<div class="df ai-c ">
									<img class="w35 h35" src="img/play/mcblack.png" ><p >黑：{{sqResult.blackNum}}子</p>
								</div>
								<div class="df ai-c">
									<img class="w35 h35" src="img/play/mcwhite.png" ><p>白：{{sqResult.whiteNum}}子</p>
								</div>
							</div>
							<p class="pt20">{{getInfo(sqResult.blackNum,sqResult.whiteNum).content}}</p>
						</div>
						<div class="wa100 tc pt25 df ac-c jc-sa fw-w">
							<button type="button" onclick="layer.closeAll()" class="layer-btn1 bg_cmyesbtn w156 h70 btn-n caa4800 fs26 fwb">确定</button>
						</div>
					</div>
				</div>
				
				<!-- 比赛结果 -->
				<div id="matchResult" class="wa100 ha100 layer_bg1 dn">
					<div class="wa100 ha100 df ac-c fw-w">
						<p class="wa100 pb10 tc caa4800 fs36 fwb">比赛结果</p>
						<div class="w520 h240 m0a bgf br32 fs30 caa4800 oay tc pt10 lineh50">
							<p class="cff3000 fs36 pb25 pt20" v-text="bsResult.title"></p>
							<div class="df jc-sa ">
								<div class="df ai-c ">
									<img class="w35 h35" src="img/play/mcblack.png" ><p >黑：提{{vsInfo.resultList?vsInfo.resultList[0]:0}}子</p>
								</div>
								<div class="df ai-c">
									<img class="w35 h35" src="img/play/mcwhite.png" ><p>白：提{{vsInfo.resultList?vsInfo.resultList[1]:0}}子</p>
								</div>
							</div>
							<p class="pt20">{{bsResult.content}}</p>
						</div>
						<div class="wa100 tc pt25 df ac-c jc-sa fw-w pt20">
							<button type="button" @click="replay()" class="bg_cmyesbtn w156 h70 btn-n caa4800 fs26 fwb">确认</button>
						</div>
					</div>
				</div>
				
				<!-- 胜负结果弹框 -->
				<div class='width100 height100 posrel dn' id='chessResult'>
					<div class="modal-content width100 height100 win  posrel">
						<div :class="['modal-body',
							{'win':alertResult.state===1},
							{'lose':alertResult.state===2},
							{'pingju':alertResult.state===3},
							{'invalid':alertResult.state===4}]" id="win">
							<div class="chessItem disflex flexcol ac width100 posabs tp208">
								<div id="showChessNews" class="disflex flexcol ac width100 textcenter pad-lt25">
									<span id="win-result" class="disbk win-result fontsz15">黑棋</span>
									<span class="disbk riseOrFall fontsz15">升降</span>
								</div>
								<div class="graph disflex jc-sa ac width100 h241">
									<div class="power fontsz15" id="power"></div>
								</div>
							</div>
						</div>
						<div class="modal-footer disflex jc-sa">
							<button onclick='addToMyFriend()' class="btn btn-info crad4">加为好友</button>
							<button @click="tryAgain()" class="btn btn-info cr096">再来一局</button>
							<!-- <button class="btn btn-info craa1" data-dismiss="modal" onclick='researchGame()' aria-label="Close">复盘</button> -->
						</div>
					</div>
				</div>
				<!-- 进度条 -->
				<div id="optLoading" class="dn">
					<div class='wa100 ha100 df ai-c jc-c loadingWarp'>
						<div class='loadingBox'>
							<p>正在为您匹配，请耐心等待！</p>
							<div class='loadingBarbg m0a rel'>
								<div class='loadingBar'>
									<img class='wa100 ha100 fl' alt="" src="img/loading/loadingBar.png">
									<p class='wa100 rel tp0 fs20'>Loading...<span class='timeNum'>0</span>%</p>
								</div>
								
							</div>
							<button class='btn-n'></button>
						</div>
					</div>
				</div>
			</div>
			
			<audio src="music/STONE0.wav" data-name = "落子声" type="hidden" id="stepmusic"></audio>
			<audio src="music/START.wav" data-name = "对局开始" type="hidden" id="startmusic"></audio>
			<audio src="music/ChipMany.wav" data-name = "提子声" type="hidden" id="takemusic"></audio>
			<audio src="music/CELEBRATE.wav" data-name = "祝贺您取得胜利" type="hidden" id="winmusic"></audio>
			<audio src="music/COMFORT.wav" data-name = "您辛苦了感谢" type="hidden" id="losemusic"></audio>
			<audio src="music/COUNTDOWN.wav" data-name = "现在开始读秒" type="hidden" id="countdownmusic"></audio>
			<audio src="music/10.wav" type="hidden" id="second10music" class="second"></audio>
			<audio src="music/9.wav" type="hidden" id="second9music" class="second"></audio>
			<audio src="music/8.wav" type="hidden" id="second8music" class="second"></audio>
			<audio src="music/7.wav" type="hidden" id="second7music" class="second"></audio>
			<audio src="music/6.wav" type="hidden" id="second6music" class="second"></audio>
			<audio src="music/5.wav" type="hidden" id="second5music" class="second"></audio>
			<audio src="music/4.wav" type="hidden" id="second4music" class="second"></audio>
			<audio src="music/3.wav" type="hidden" id="second3music" class="second"></audio>
			<audio src="music/2.wav" type="hidden" id="second2music" class="second"></audio>
			<audio src="music/1.wav" type="hidden" id="second1music" class="second"></audio>
			
		</div>

		
		<script type="text/javascript">

			//读秒到倒计时
			var djs = new countDown(function(t){
			
				if(matchPlay.game.config.first){ //当前白下
					matchPlay.whiteSeconds = t;
					if(t===0){
						matchPlay.vsInfo.whiteCounts ++;
						if(matchPlay.game.config.userFirst===1){
							eve.f('countingCounts',uid,matchPlay.gameInfo.gameId)()
						}
						if(matchPlay.vsInfo.whiteCounts<matchPlay.countNum){
							djs.timout(matchPlay.stepTime);
						}
					}
				}else{ //当前黑下
					matchPlay.blackSeconds = t;
					if(t===0){
						matchPlay.vsInfo.blackCounts ++;
						if(matchPlay.game.config.userFirst===0){
							eve.f('countingCounts',uid,matchPlay.gameInfo.gameId)()
						}
						if(matchPlay.vsInfo.blackCounts<matchPlay.countNum){
							djs.timout(matchPlay.stepTime);
						}
						
					}
				}
			})
			
			//基础用时倒计时
			var timer = new countDown(function(time){
				//console.log(55,time)
				
				if(matchPlay.game.config.first){
					djs.flag = 0;
					matchPlay.whiteTime = time;					
					if(time===0){
						djs.timout(matchPlay.whiteSeconds) //新一轮读秒 传入白棋所剩读秒
					}
				}else{
					djs.flag = 0;
					matchPlay.blackTime = time;
					if(time===0){
						djs.timout(matchPlay.blackSeconds) //新一轮读秒 传入黑棋所剩读秒
					}
				}
				
			})
			
			
			
			var matchPlay = new Vue({
				el:'#matchPlay',
				data:{
					game:'', //比赛棋盘实例
					qrlzState:0, //确认落子返回的状态 1 0
					gameInfo:'', //对局信息
					opponentId:'',//对手id
					vsInfo:'',
					totalTime:10, //总用时
					activeUser:'', //当前下棋的人 0黑 1白
					blackTime:'',//黑棋所剩基础时间
					whiteTime:'',//白棋所剩基础时间
					blackSeconds:30, //黑棋读秒
					whiteSeconds:30, //白棋读秒
					stepTime:30	,//基础读秒时间
					countNum:3,//基础用时
					sqResult:{ //数棋结果
						title:'',
						blackNum: '',
						whiteNum:'',
						content:''
					},
					bsResult:{ //比赛结果
						title:'',
						content:''
					},
					jugementType:1, //如果为1 点数棋同意按钮代表向对手发起数棋， 如果为 2代表对手接受到了数棋结果此时点同意代表接受数棋
					isTry:0,//试下状态
					isReplay:0, //复盘状态 1是 0不是
					
					//对局结束状态
					alertResult:{
						state:1, //1胜 2败 3平 4无效
					},
					//形式判断结果
					jugementResult:{
						blackSum:'', //黑棋目数
						whiteSum:'' //白棋目数
					},
					rulesName:''
				},
				methods:{
					
					//获取上把对弈AI参数
					getAIParam:function(){
						const $this = this;
						$.ajax({
							url: http+'/gobangteach/ChessController/getAIParam',
							type: "GET",
							contentType: "application/json",
							data: {
								chessid:$this.gameInfo.gameId,
								token:token,
								uid:uid
							},
							dataType: "json",
							success: function (data) {
								if (data.error.returnCode == 0) {
									$this.createAIChess(data.data.ai_level,data.data.color,data.data.count,data.data.size)
								} else {
									layerTC(data.error.returnUserMessage);
								}
							},
							error: function (XMLHttpRequest, textStatus) {
								layerTC("服务器错误！！！");
							}
						});
					},
					
					
					//创建AI 棋局
					createAIChess :function (ai_level,color,count,size) {
						const $this = this;
						$.ajax({
							url: http+'/gobangteach/ChessController/createAIChess',
							type: "GET",
							data: {
								ai_level: ai_level,
								size:size,
								count:count,
								color:color, //'white'//black
								guide:'',
								token:token,
								uid:uid
							},
							dataType: "json",
							success: function (data) {
								if (data.error.returnCode == 0) {
									console.log("创建成功",data);
									$this.getGameInfoByUserId()
								} else {
									layerTC(data.error.returnUserMessage)
								}
								
							},
							error: function (XMLHttpRequest, textStatus) {}
						});
					}, 
					//创建 匹配AI
					createAIMatch:function(){
						const $this = this;
						$.ajax({
							url : http+'/gobangteach/ChessController/createAIMatch',
							type : "POST",
							timeout : 5000, // 单位毫秒
							data : {
								ai_level: "1",
								token:token,
								uid:uid
							},
							dataType : "json",
							success : function(data) {
								if (data.error.returnCode == 0) {
									$this.getGameInfoByUserId()
								} else {
									layerTC("系统错误: " + data.error.returnUserMessage);
								}
							},
							error : function(XMLHttpRequest, textStatus) {
								layerTC("服务器错误！！！");
							}
						});
					},
					//随机匹配
					randomBattle:function () {
						const $this = this;
						$.ajax({
							url : http+'/gobangteach/ChessController/randomBattle',
							type : "POST",
							timeout : 5000, // 单位毫秒
							data:{
								token:token,
								uid:uid
							},
							beforeSend : function(XMLHttpRequest) {
								//popupLoading(1);
								$this.loadingChess(10)
							},
							success : function(data) {
								console.log(data)
								if (data.error.returnCode == 0 || data.error.returnCode == 2) {
									
								} else{
									layerTC(data.error.returnUserMessage);
									//popdownLoading();
								}
							}
						});
					},
					//再来一局
					tryAgain:function () {
						const gameType = this.gameInfo.GameType;
						layer.closeAll();
						this.game.switchChess(this.game.config.road) //清空棋盘在创建
						if(gameType===4){
							$this.getAIParam()
						}else{
							this.randomBattle();
							//this.loadingChess()
						}
					},
					//匹配进度条
					loadingChess:function (time){
						let $this = this;
						$('#optLoading').css('display','block')
						var timeNum = time*1000;
						var num = timeNum/100;
						var step = 100/num;
						var index =1
						var timer = setInterval(function() {
							num --;
							
							if(num<=0){
								clearInterval(timer)
								$this.getGameInfoByUserId(function(){
									$this.createAIMatch();
									$('#optLoading').hide()
								})
							}else{
								index++;
								$(".loadingBar img").css('left',(-100+step*index)+'%');
								$(".loadingBar .timeNum").text(index)
								console.log('ss',step*index)
							}
						}, 100)
						
						$('#optLoading button').click(function(){
							clearInterval(timer)
							$('#optLoading').hide()
						})
						
					},
					//查询积分
					getJF:function(){
						$.ajax({
							type : "GET",
							url : http+"/gobangteach/ChessController/chessJF",
							data:{
								uid:uid,
								token:token
							},
							success : function(data) {
								if(data.data>0){
									//如果本次对弈有积分弹出提示 两秒后关闭
									$(".getJf").show();
									setTimeout(function(){
										$(".getJf").hide();
									},3000)
								}
							}
						})
					},
					//查询等级升降
					levelUpOrDown:function (){
						$.ajax({
							type : "GET",
							url : http+'/gobangteach/UserBaseController/levelUpOrDown',
							data:{
								userId:uid,
								uid:uid,
								token:token
							},
							dataType : 'json',
							success : function(data) {
								console.log(data);
								var riseOrFall = data.data.riseOrFall;
								if(riseOrFall>0){
									$(".riseOrFall").show().text('恭喜你晋升'+riseOrFall+'级');
								}else if(riseOrFall<0){
									$(".riseOrFall").show().text('很遗憾你降了'+riseOrFall*-1+'级');
								}else{
									$(".riseOrFall").text('');
								}
							},
							error : function(XMLHttpRequest, data) {
								layerTC("系统错误！");
							}
						});
					},

				},
				watch:{
					blackSeconds:function(val){
						if(this.game.config.userFirst===0){
							if(val<=10&&val>0){
								this.playAudio('second'+val+'music')
							}
						}
						
					},
					whiteSeconds:function(val){
						if(this.game.config.userFirst===1){
							if(val<=10&&val>0){
								this.playAudio('second'+val+'music') //10 9 8...
							}
						}
					},
					blackTime:function(val){
						const $this = this;
						if(val===1 && this.game.config.userFirst===0){
							setTimeout(function(){
								$this.playAudio('countdownmusic') //现在开始读秒
							},1000)
						}
					},
					whiteTime:function(val){
						const $this = this;
						if(val===1 && this.game.config.userFirst===1){
							setTimeout(function(){
								$this.playAudio('countdownmusic') //现在开始读秒
							},1000)
						}
					}
				},
				mounted:function(){
					var $this = this;
					play2(this);

					var game = this.game
					
					//链接成功回调
					eve.on('socketOpen',function(){
						console.log('链接成功');
						$this.getGameInfoByUserId();
					})
					
					//形式判断返回结果
					eve.on("jugementResult", function(data) {
						var mu = game.jugement(data);
						$this.sqResult.blackNum = mu.B;
						$this.sqResult.whiteNum = mu.W;
					});
					eve.on('StatisticalForceRefuse',function(){
						layerTC('存在公气,不允许强制数棋')
					})

					
					//棋局结束
					eve.on("notifyGameOver", function(status) {
						console.log('棋局结束:',status)
						switch (status){
							case 1:
								//alert('黑棋认输，白中盘胜')
								$this.bsResult.title = '白中盘胜'
								$this.bsResult.content = '黑棋认输'
								//$this.jugement()
								break;
							case 2:
								//alert('白棋认输，黑中盘胜')
								$this.bsResult.title = '黑中盘胜'
								$this.bsResult.content = '白棋认输'
								break;
							case 3:
								//alert('白棋求和，黑棋同意')
								$this.bsResult.title = '平局'
								$this.bsResult.content = '白棋求和，黑棋同意'
								break;
							case 4:
								//alert('黑棋求和，白棋同意')
								$this.bsResult.title = '平局'
								$this.bsResult.content = '黑棋求和，白棋同意'
								break;
							case 5:
								//alert('黑棋超时')
								$this.bsResult.title = '白中盘胜'
								$this.bsResult.content = '黑棋超时'
								break;
							case 6:
								//alert('白棋超时')
								$this.bsResult.title = '黑中盘胜'
								$this.bsResult.content = '白棋超时'
								break;
							case 7:
								//alert('黑白棋各停一手，进入数棋');
								$this.bsResult.content = '黑白棋各停一手'
								break;	
							case 8:
								//alert('白棋发起数棋，黑棋同意')
								$this.bsResult.content = '白棋发起数棋，黑棋同意'
								break;	
							case 9:
								//alert('黑棋发起数棋，白棋同意')
								$this.bsResult.content = '黑棋发起数棋，白棋同意'
								break;
							case 10:
								//alert('黑棋发起强制数棋')
								$this.bsResult.content = '黑棋发起强制数棋'
								break;
							case 11:
								//alert('白棋发起强制数棋')
								$this.bsResult.content = '白棋发起强制数棋'
								break;	
							case 12:
								//alert('答题错误')
								$this.bsResult.content = '答题错误'
								break;
							case 13:
								//alert('答题正确')
								$this.bsResult.content = '答题正确'
								break;
							case 14:
								//alert('9路吃子黑棋胜')
								$this.bsResult.title = '黑棋胜'
								$this.bsResult.content = '9路吃子黑棋胜'
								break;
							case 15:
								//alert('9路吃子白棋胜')
								$this.bsResult.title = '白棋胜'
								$this.bsResult.content = '9路吃子白棋胜'
								break;	
							default:
								break;
						}
						timer.flag = 0; //关闭基础时间倒计时
						djs.flag = 0; //关闭读秒
						layer.closeAll()

						//关闭棋局
						$this.closeGame(function(data){
							if(data!=4){
								var blackSum = $this.sqResult.blackNum;
								var whiteSum = $this.sqResult.whiteNum;
								var resultSum = '';
								//如果是数棋操作
								if (blackSum !== '' || whiteSum !== ''){
									if((blackSum+whiteSum)==361){
										resultSum = blackSum - 180.5 - 3.75;
									}else{
										resultSum = blackSum - whiteSum - 3.75;
									}
									$this.bsResult.title = $this.getInfo(blackSum,whiteSum).content
								}
								
								$(".win-result").html($this.bsResult.title);
								
						
								//当前用户为用户棋的颜色 0黑 1白
								var myColor = $this.game.config.userFirst
								
								/* 
									1-.win-胜、2-.lose-败、3-.pingju-平、4-.invalid-无效
								 */
								
								if(myColor == 0 && (status == 1 || status == 5 || status == 15)) {
									$this.alertResult.state = 2	//黑棋负 失败
								} else if(myColor == 1 && ((status == 2 || status == 6  || status == 14))) {//白棋负
									$this.alertResult.state = 2	//白棋负 失败
								} else if(status==3||status==4){
									$this.alertResult.state = 3 //平局
								} else if(myColor == 0 && resultSum<0) {
									$this.alertResult.state = 2 //失败
								} else if(myColor == 1 && resultSum>0) {
									$this.alertResult.state = 2	//失败
								}else{
									$this.alertResult.state = 1 //胜利
								}
								
								//请求能力图数据
								$this.drawChart($this.gameInfo);
						
								//$('#researchGame').removeClass('disabled');
								//查询等级升降
								$this.levelUpOrDown()
								//查询积分
								$this.getJF()
						
								
							}else{
								//无效对局
								$this.alertResult.state = 4;
								$(".win-result").html('');
							}
							
							$this.playAudio($this.alertResult.state);
							
							layerOpen({area: ['5.2rem', '7.8rem'],skin:'layerOpen chessResult',content: $("#chessResult")});
							$this.replay()
						})
					});

					//接收推送消息
					eve.on('informReply',function(data){
						switch (data){
							case 1: //申请数棋
								layerTC({
									closeBtn:0,
									content:'对手请求数棋'
								},function(){
									//同意
									eve.f('statisticalYes',uid,$this.gameInfo.gameId)();
								},function(){
									//拒绝
									eve.f('inform',$this.opponentId,101)(); 
								}) 
								break;
							case 101: //拒绝数棋
								layer.closeAll()
								layerTC('对方拒绝数棋请求！')
								break;
							case 2: //同意和棋
								//$this.jugement()
								layerTC('对手请求和棋',function(){
									//同意
									eve.f('answerdrawYes',uid,$this.gameInfo.gameId)();
								},function(){
									//拒绝
									eve.f('inform',$this.opponentId,202)(); 
								}) 
								break;
							case 202: //拒绝和棋
								layerTC('对方拒绝和棋请求！')
								break;
							case 3: //发送悔棋通知
								layerTC('对手请求悔棋',function(){
									//同意
									eve.f('answerundoyes',$this.gameInfo.gameId)();
								},function(){
									//拒绝
									eve.f('inform',$this.opponentId,301)();
								}) 
								break;	
							case 301: //拒绝悔棋
								layerTC('对方拒绝悔棋请求');
								break;
							case 4: //停一手
								layerTC('对手停一手');
								break;
							default:
								break;
						}
					})
					//支招结果
					eve.on('AIHelperReply',function(data){
						console.log('ai支招结果：'+data)
						game.AIHelper(data)
					})
					//悔棋结果
					eve.on('AnswerUndoYesNotify',function(data){
						console.log('悔棋结果：'+data)
						var chessData = $this.game.svgFormatting().slice(0,-data.length)
						$this.game.svg = chessData
					})
					//同意数棋回调
					eve.on("consentShuqi",function(){
						console.log('同意数棋')
						eve.f('jugement',uid,game.svgFormatting())();
					})
					
				}
				
			})
			
		</script>
	</body>
</html>
